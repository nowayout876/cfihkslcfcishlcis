<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Palestine Profile Maker</title>
  <style>
    body { font-family: sans-serif; text-align: center; background: #f2f2f2; }
    canvas { border-radius: 50%; background: #fff; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    .controls { margin-top: 1em; }
    .frame-select { margin: 1em auto; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <h1>Palestine Profile Maker</h1>
  <input type="file" id="upload" accept="image/*" />
  <div class="frame-select">
    <label for="frameSelect">Choose Frame:</label>
    <select id="frameSelect">
      <option value="default">Default</option>
      <option value="country">With Country Flag</option>
      <option value="hashtag">#FreePalestine</option>
    </select>
  </div>

  <canvas id="previewCanvas" width="300" height="300"></canvas>

  <div class="controls">
    <label>Zoom: <input type="range" id="zoom" min="0.5" max="2" step="0.01" value="1"></label><br/>
    <label>Rotate: <input type="range" id="rotate" min="-3.14" max="3.14" step="0.01" value="0"></label><br/>
    <button id="downloadBtn" class="hidden">Download</button>
  </div>

  <script>
    const upload = document.getElementById("upload");
    const frameSelect = document.getElementById("frameSelect");
    const canvas = document.getElementById("previewCanvas");
    const ctx = canvas.getContext("2d");
    const zoomInput = document.getElementById("zoom");
    const rotateInput = document.getElementById("rotate");
    const downloadBtn = document.getElementById("downloadBtn");

    let userImage = null;
    let frameImage = new Image();
    let scale = 1;
    let rotation = 0;

    const frames = {
      default: "bg.webp",
      country: "flags/eg.png", // Replace with dynamic flag later
      hashtag: "overlay-freepalestine.webp"
    };

    function loadFrame(name) {
      frameImage.src = frames[name] || frames.default;
    }

    function drawCanvas() {
      ctx.clearRect(0, 0, 300, 300);

      if (userImage) {
        ctx.save();
        ctx.beginPath();
        ctx.arc(150, 150, 130, 0, Math.PI * 2);
        ctx.clip();
        ctx.translate(150, 150);
        ctx.rotate(rotation);
        const size = 300 * scale;
        ctx.drawImage(userImage, -size/2, -size/2, size, size);
        ctx.restore();
      }

      if (frameImage.complete) {
        ctx.drawImage(frameImage, 0, 0, 300, 300);
      }
    }

    upload.addEventListener("change", e => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function (event) {
        userImage = new Image();
        userImage.onload = () => {
          drawCanvas();
          downloadBtn.classList.remove("hidden");
        };
        userImage.src = event.target.result;
      };
      reader.readAsDataURL(file);
    });

    frameSelect.addEventListener("change", e => {
      loadFrame(e.target.value);
    });

    zoomInput.addEventListener("input", () => {
      scale = parseFloat(zoomInput.value);
      drawCanvas();
    });

    rotateInput.addEventListener("input", () => {
      rotation = parseFloat(rotateInput.value);
      drawCanvas();
    });

    downloadBtn.addEventListener("click", () => {
      const link = document.createElement("a");
      link.download = "palestine-profile.png";
      link.href = canvas.toDataURL();
      link.click();
    });

    // Load default frame on startup
    loadFrame("default");
    frameImage.onload = drawCanvas;
  </script>
</body>
</html>
